<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Annotations · NMRTools.jl</title><meta name="title" content="Annotations · NMRTools.jl"/><meta property="og:title" content="Annotations · NMRTools.jl"/><meta property="twitter:title" content="Annotations · NMRTools.jl"/><meta name="description" content="Documentation for NMRTools.jl."/><meta property="og:description" content="Documentation for NMRTools.jl."/><meta property="twitter:description" content="Documentation for NMRTools.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="NMRTools.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">NMRTools.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Getting started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorial-data/">Working with NMR data</a></li><li><a class="tocitem" href="../tutorial-plotrecipes/">Plotting</a></li><li><a class="tocitem" href="../tutorial-metadata/">Metadata</a></li><li><a class="tocitem" href="../tutorial-animation/">Animating spectra</a></li><li><a class="tocitem" href="../tutorial-relaxation/">1D relaxation analysis</a></li><li><a class="tocitem" href="../tutorial-diffusion/">Diffusion analysis</a></li></ul></li><li><a class="tocitem" href="../utilities/">Utilities</a></li><li><span class="tocitem">Reference guide</span><ul><li><a class="tocitem" href="../ref-metadata/">Metadata</a></li><li class="is-active"><a class="tocitem" href>Annotations</a><ul class="internal"><li><a class="tocitem" href="#Motivation"><span>Motivation</span></a></li><li><a class="tocitem" href="#Design-Principles"><span>Design Principles</span></a></li><li><a class="tocitem" href="#Annotation-Syntax"><span>Annotation Syntax</span></a></li><li><a class="tocitem" href="#Using-Annotations-in-NMRTools.jl"><span>Using Annotations in NMRTools.jl</span></a></li></ul></li><li><a class="tocitem" href="../ref-coherences/">Coherences and isotope data</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../indexes/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference guide</a></li><li class="is-active"><a href>Annotations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Annotations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/waudbygroup/NMRTools.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/waudbygroup/NMRTools.jl/blob/master/docs/src/ref-annotations.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="NMR-Pulse-Programme-Semantic-Annotation-System"><a class="docs-heading-anchor" href="#NMR-Pulse-Programme-Semantic-Annotation-System">NMR Pulse Programme Semantic Annotation System</a><a id="NMR-Pulse-Programme-Semantic-Annotation-System-1"></a><a class="docs-heading-anchor-permalink" href="#NMR-Pulse-Programme-Semantic-Annotation-System" title="Permalink"></a></h1><div class="admonition is-warning" id="Alpha-Development-Status-9742c97176ee953c"><header class="admonition-header">Alpha Development Status<a class="admonition-anchor" href="#Alpha-Development-Status-9742c97176ee953c" title="Permalink"></a></header><div class="admonition-body"><p>This annotation system is in early alpha development. The schema, syntax, and functionality are subject to significant changes. Use with caution in production environments.</p></div></div><h2 id="Motivation"><a class="docs-heading-anchor" href="#Motivation">Motivation</a><a id="Motivation-1"></a><a class="docs-heading-anchor-permalink" href="#Motivation" title="Permalink"></a></h2><p>Modern NMR pulse programmes are cryptic text files that encode complex experimental procedures, but they lack semantic information about what they actually measure. Analysis software must guess at the meaning of parameters like <code>VALIST</code> or <code>VPLIST</code>, leading to errors and requiring manual interpretation.</p><p>This annotation system embeds structured semantic metadata directly within pulse programme files as comments, enabling:</p><ul><li><strong>Automated Analysis</strong>: Software can automatically understand experimental structure</li><li><strong>Reproducible Research</strong>: Clear provenance and citation information</li><li><strong>Knowledge Preservation</strong>: Experimental design captured alongside implementation</li><li><strong>Cross-Platform Compatibility</strong>: Vendor-agnostic semantic layer</li><li><strong>Collaborative Development</strong>: Track contributors and development status</li></ul><div class="admonition is-info" id="Current-Implementation-3beca6fee92bbe77"><header class="admonition-header">Current Implementation<a class="admonition-anchor" href="#Current-Implementation-3beca6fee92bbe77" title="Permalink"></a></header><div class="admonition-body"><p>Basic annotation parsing is implemented in NMRTools.jl. The system is under active development with ongoing refinement of the schema and parsing capabilities.</p></div></div><h2 id="Design-Principles"><a class="docs-heading-anchor" href="#Design-Principles">Design Principles</a><a id="Design-Principles-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Principles" title="Permalink"></a></h2><h3 id="Human-and-Machine-Readable"><a class="docs-heading-anchor" href="#Human-and-Machine-Readable">Human and Machine Readable</a><a id="Human-and-Machine-Readable-1"></a><a class="docs-heading-anchor-permalink" href="#Human-and-Machine-Readable" title="Permalink"></a></h3><p>Annotations use simple comment syntax that NMR spectroscopists can read naturally whilst being structured enough for automated parsing.</p><h3 id="Embedded-and-Immutable"><a class="docs-heading-anchor" href="#Embedded-and-Immutable">Embedded and Immutable</a><a id="Embedded-and-Immutable-1"></a><a class="docs-heading-anchor-permalink" href="#Embedded-and-Immutable" title="Permalink"></a></h3><p>Metadata travels with the pulse programme file and cannot drift out of sync with the code.</p><h3 id="Modular-and-Extensible"><a class="docs-heading-anchor" href="#Modular-and-Extensible">Modular and Extensible</a><a id="Modular-and-Extensible-1"></a><a class="docs-heading-anchor-permalink" href="#Modular-and-Extensible" title="Permalink"></a></h3><p>Experiments are described as combinations of core types and features, allowing new variations without redefining the entire taxonomy.</p><h3 id="Version-Controlled"><a class="docs-heading-anchor" href="#Version-Controlled">Version Controlled</a><a id="Version-Controlled-1"></a><a class="docs-heading-anchor-permalink" href="#Version-Controlled" title="Permalink"></a></h3><p>Both individual pulse programmes and the annotation system itself are versioned for reproducibility and compatibility.</p><h2 id="Annotation-Syntax"><a class="docs-heading-anchor" href="#Annotation-Syntax">Annotation Syntax</a><a id="Annotation-Syntax-1"></a><a class="docs-heading-anchor-permalink" href="#Annotation-Syntax" title="Permalink"></a></h2><h3 id="Basic-Format"><a class="docs-heading-anchor" href="#Basic-Format">Basic Format</a><a id="Basic-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Format" title="Permalink"></a></h3><p>Annotations are extensions of Bruker comment lines, and are marked <code>;@</code>. Within these lines, annotations are written in YAML format. The initial <code>;@</code> will be stripped when parsing, permitting multi-line entries.</p><pre><code class="nohighlight hljs">;@ parameter: text value
;@ parameter1: 0.123
;@ parameter2: [list, of, items]
;@ parameter3: {associative: array, key:value}
;@ parameter4: |
;@   This is
;@   a multi-line
;@   entry.</code></pre><p><strong>Angle brackets <code>&lt;&gt;</code></strong> within an entry should be interpreted as a reference to auxiliary files (following TopSpin conventions).</p><h2 id="Using-Annotations-in-NMRTools.jl"><a class="docs-heading-anchor" href="#Using-Annotations-in-NMRTools.jl">Using Annotations in NMRTools.jl</a><a id="Using-Annotations-in-NMRTools.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Annotations-in-NMRTools.jl" title="Permalink"></a></h2><p>The complete annotation schema is defined at https://waudbylab.org/pulseprograms/schema/fields/. In NMRTools.jl, parsed annotation data is accessible via the <code>:annotations</code> metadata field or the <a href="../api/#NMRTools.NMRBase.annotations-Tuple{AbstractNMRData}"><code>annotations()</code></a> convenience function.</p><h3 id="Accessing-annotation-data"><a class="docs-heading-anchor" href="#Accessing-annotation-data">Accessing annotation data</a><a id="Accessing-annotation-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-annotation-data" title="Permalink"></a></h3><p>Annotations can be accessed using the <code>annotations()</code> function, which provides convenient nested access to annotation data:</p><pre><code class="language-julia hljs"># Load a spectrum with annotations
spec = loadnmr(&quot;path/to/annotated/experiment&quot;)

# Access all annotations
all_annotations = annotations(spec)

# Access specific annotation fields
experiment_type = annotations(spec, &quot;experiment_type&quot;)

# Access nested dictionary fields
spinlock_duration = annotations(spec, &quot;spinlock&quot;, &quot;duration&quot;)

# Access array elements by index
first_dimension = annotations(spec, &quot;dimensions&quot;, 1)

# Alternatively, use direct metadata access
annotations_dict = spec[:annotations]
experiment_type = annotations_dict[&quot;experiment_type&quot;]</code></pre><p>The <code>annotations()</code> function accepts both string and symbol keys, and returns <code>nothing</code> if the requested field does not exist.</p><h3 id="Example:-19F-R1ρ-on-resonance-experiment"><a class="docs-heading-anchor" href="#Example:-19F-R1ρ-on-resonance-experiment">Example: 19F R1ρ on-resonance experiment</a><a id="Example:-19F-R1ρ-on-resonance-experiment-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-19F-R1ρ-on-resonance-experiment" title="Permalink"></a></h3><p>This example experiment is annotated as follows:</p><pre><code class="nohighlight hljs">;@ schema_version: &quot;0.0.1&quot;
;@ sequence_version: &quot;0.1.0&quot;
;@ title: 19F on-resonance R1rho relaxation dispersion
;@ authors:
;@   - Chris Waudby &lt;c.waudby@ucl.ac.uk&gt;
;@   - Jan Overbeck
;@ created: 2020-01-01
;@ last_modified: 2025-08-01
;@ repository: github.com/waudbygroup/pulseprograms
;@ status: beta
;@ experiment_type: [r1rho, 1d]
;@ features: [relaxation dispersion, on-resonance, temperature compensation]
;@ nuclei_hint: [19F, 1H]
;@ citation:
;@   - Overbeck (2020)
;@ dimensions: [spinlock_duration, spinlock_power, f1]
;@ acquisition_order: [3, 1, 2]
;@ decoupling: [nothing, nothing, f2]
;@ hard_pulse:
;@ - {channel: f1, length: p1, power: pl1}
;@ - {channel: f2, length: p3, power: pl2}
;@ decoupling_pulse:
;@ - {channel: f2, length: p4, power: pl12, program: cpdprg2}
;@ spinlock: {channel: f1, power: &lt;VALIST&gt;, duration: &lt;VPLIST&gt;, offset: 0, alignment: hard_pulse}</code></pre><p>Using the test data <code>19F-r1rho-onres</code>, we can parse these annotations:</p><pre><code class="language-julia hljs">using NMRTools

# Load the annotated experiment
spec = loadnmr(&quot;test/test-data/19F-r1rho-onres&quot;)

# View all available annotations
spec[:annotations]

# Access experiment metadata using annotations() function
annotations(spec, &quot;title&quot;)           # &quot;19F on-resonance R1rho relaxation dispersion&quot;
annotations(spec, &quot;experiment_type&quot;) # [&quot;r1rho&quot;, &quot;1d&quot;]
annotations(spec, &quot;features&quot;)        # [&quot;relaxation dispersion&quot;, &quot;on-resonance&quot;, &quot;temperature compensation&quot;]

# Access nested spinlock parameters
annotations(spec, &quot;spinlock&quot;, &quot;power&quot;)    # list of powers, [Power(36.82 dB, 0.0002079696687103696 W), ...]
annotations(spec, &quot;spinlock&quot;, &quot;duration&quot;) # list of durations, [0.00001, 0.005, 0.01, ...]
annotations(spec, &quot;spinlock&quot;, &quot;channel&quot;)  # &quot;19F&quot;
annotations(spec, &quot;spinlock&quot;, &quot;offset&quot;)   # 0 (on-resonance)

# Access dimension information
annotations(spec, &quot;dimensions&quot;)    # [&quot;spinlock_duration&quot;, &quot;spinlock_power&quot;, &quot;f1&quot;]
annotations(spec, &quot;dimensions&quot;, 1) # &quot;spinlock_duration&quot;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ref-metadata/">« Metadata</a><a class="docs-footer-nextpage" href="../ref-coherences/">Coherences and isotope data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 1 October 2025 14:19">Wednesday 1 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
